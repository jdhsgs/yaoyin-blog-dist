(window.webpackJsonp=window.webpackJsonp||[]).push([[17],{548:function(e,t,s){"use strict";s.r(t);var a=s(12),n=Object(a.a)({},(function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("ContentSlotsDistributor",{attrs:{"slot-key":e.$parent.slotKey}},[s("h3",{attrs:{id:"简介"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#简介"}},[e._v("#")]),e._v(" 简介")]),e._v(" "),s("p",[e._v("在讲 python 的 pyppeteer 前，先来说下 Node 的 puppeteer 库：")]),e._v(" "),s("p",[e._v("puppeteer的中文意思是：操纵木偶的人，木偶师。")]),e._v(" "),s("p",[e._v("那么 Node 的 puppeteer 是什么呢？")]),e._v(" "),s("blockquote",[s("p",[e._v("Puppeteer 是一个 Node 库，它提供了高级的 API 来控制 Chrome/Chromium，通过 DevTools 协议。Puppeteer默认使用无头浏览器，但是通过配置可以控制完整的 Chrome/Chromium 浏览器。\n英文原文地址：https://github.com/puppeteer/puppeteer#puppeteer")])]),e._v(" "),s("p",[e._v("通过介绍，再看 puppeteer 的图标，一个被操纵的浏览器，就会觉得很形象、直观有木有。\n"),s("img",{attrs:{src:"https://img-blog.csdnimg.cn/20210323135055922.png",alt:"在这里插入图片描述"}}),e._v("\nPuppeteer 库是由 Chrome DevTools 团队维护的。")]),e._v(" "),s("p",[e._v("说完了 Node 的 puppeteer 再回过来看 pyppeteer")]),e._v(" "),s("blockquote",[s("p",[e._v("pyppeteer 是 puppeteer 的非官方 python 版")])]),e._v(" "),s("p",[e._v("了解 js 的同学知道，python 和 js 在很多方面挺像的，所以 pyppeteer 也力求尽可能的和 puppeteer 一致，但由于底层的不同，它们还是有些差异的，更多信息可以查看相关的官网。")]),e._v(" "),s("h3",{attrs:{id:"官网信息"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#官网信息"}},[e._v("#")]),e._v(" 官网信息")]),e._v(" "),s("p",[s("strong",[e._v("pyppeteer")])]),e._v(" "),s("ul",[s("li",[e._v("github 地址：https://github.com/pyppeteer/pyppeteer")]),e._v(" "),s("li",[e._v("文档：https://pyppeteer.github.io/pyppeteer/reference.html\n"),s("strong",[e._v("puppeteer")])]),e._v(" "),s("li",[e._v("github 地址：https://github.com/puppeteer/puppeteer")]),e._v(" "),s("li",[e._v("中文文档：https://zhaoqize.github.io/puppeteer-api-zh_CN/#/")]),e._v(" "),s("li",[e._v("英文文档：https://pptr.dev/")])]),e._v(" "),s("h3",{attrs:{id:"使用"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#使用"}},[e._v("#")]),e._v(" 使用")]),e._v(" "),s("p",[s("strong",[e._v("安装")]),e._v(" "),s("code",[e._v("pip install pyppeteer # Python >= 3.6")]),e._v(" "),s("strong",[e._v("配置")]),e._v("\npyppeteer 在初次运行的时候，会自动下载 chromium（版本为 588429，发布时间为 2018-09-04T09:08:12.712Z）。\n如果从国内的网直接下载，速度会很慢或无法下载，而且默认版本也比较老，因此，可以配置操作系统的环境变量，从国内的 taobao 镜像下载较新的 chromium。")]),e._v(" "),s("p",[e._v("淘宝镜像地址：\nhttps://npm.taobao.org/mirrors/chromium-browser-snapshots")]),e._v(" "),s("p",[e._v("在"),s("code",[e._v("~/.bashrc")]),e._v("文件内添加环境变量配置（此处直接通过 shell 命令将配置追加到文件底部）：")]),e._v(" "),s("div",{staticClass:"language- line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[e._v("$ echo \"export PYPPETEER_DOWNLOAD_HOST='https://npm.taobao.org/mirrors'\">>~/.bashrc\n$ echo \"export PYPPETEER_CHROMIUM_REVISION='856583'\">>~/.bashrc # 此示例版本为当前最新版，发布日期为：2021-02-26T08:47:06.448Z \n$ source ~/.bashrc # 使新环境变量生效\n")])]),e._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[e._v("1")]),s("br"),s("span",{staticClass:"line-number"},[e._v("2")]),s("br"),s("span",{staticClass:"line-number"},[e._v("3")]),s("br")])]),s("h3",{attrs:{id:"常见示例"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#常见示例"}},[e._v("#")]),e._v(" 常见示例")]),e._v(" "),s("h4",{attrs:{id:"_1-打开浏览器-打开页面-关闭浏览器"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_1-打开浏览器-打开页面-关闭浏览器"}},[e._v("#")]),e._v(" 1. 打开浏览器，打开页面，关闭浏览器")]),e._v(" "),s("p",[e._v("demo.py")]),e._v(" "),s("div",{staticClass:"language- line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[e._v("import asyncio\n\nimport pyppeteer\n\n\nasync def main():\n\texecutablePath = pyppeteer.executablePath()\n\tprint('自动下载的 chromium 的存储位置为：', executablePath)\n\t\n    browser = await pyppeteer.launch(\n    \theadless=True,  # 如果为False, 则会打开浏览器界面，适合在有界面的机器上观察浏览器行为\n    \texecutablePath=executablePath,  # 也可以指定为机器上的已安装的 Chrome 浏览器： r'C:\\Program Files (x86)\\Google\\Chrome\\Application\\chrome.exe'\n        args=[\n            '--no-sandbox'\n            #, '--proxy-server=socks5://192.168.237.1:10808'\n        ]\n    )\n    \n    page = await browser.newPage()\n    await page.setViewport({'width': 1920, 'height': 1080})  # 调整页面的尺寸为 1920*1080\n    await page.setJavaScriptEnabled(enabled=True)  # 允许 javascript 执行\n    await page.goto(\n    \t'https://baidu.com', \n    \twaitUntil='networkidle0'  # 直到未结束的网络连接数为 0，停止等待。（可以用来等待 ajax 结束）\n    )\n    html = await page.content()\n    \n   \t# 3s 后关闭浏览器\n   \tawait asyncio.sleep(3)\n    await browser.close()\n\nasyncio.get_event_loop().run_until_complete(main())\n\n")])]),e._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[e._v("1")]),s("br"),s("span",{staticClass:"line-number"},[e._v("2")]),s("br"),s("span",{staticClass:"line-number"},[e._v("3")]),s("br"),s("span",{staticClass:"line-number"},[e._v("4")]),s("br"),s("span",{staticClass:"line-number"},[e._v("5")]),s("br"),s("span",{staticClass:"line-number"},[e._v("6")]),s("br"),s("span",{staticClass:"line-number"},[e._v("7")]),s("br"),s("span",{staticClass:"line-number"},[e._v("8")]),s("br"),s("span",{staticClass:"line-number"},[e._v("9")]),s("br"),s("span",{staticClass:"line-number"},[e._v("10")]),s("br"),s("span",{staticClass:"line-number"},[e._v("11")]),s("br"),s("span",{staticClass:"line-number"},[e._v("12")]),s("br"),s("span",{staticClass:"line-number"},[e._v("13")]),s("br"),s("span",{staticClass:"line-number"},[e._v("14")]),s("br"),s("span",{staticClass:"line-number"},[e._v("15")]),s("br"),s("span",{staticClass:"line-number"},[e._v("16")]),s("br"),s("span",{staticClass:"line-number"},[e._v("17")]),s("br"),s("span",{staticClass:"line-number"},[e._v("18")]),s("br"),s("span",{staticClass:"line-number"},[e._v("19")]),s("br"),s("span",{staticClass:"line-number"},[e._v("20")]),s("br"),s("span",{staticClass:"line-number"},[e._v("21")]),s("br"),s("span",{staticClass:"line-number"},[e._v("22")]),s("br"),s("span",{staticClass:"line-number"},[e._v("23")]),s("br"),s("span",{staticClass:"line-number"},[e._v("24")]),s("br"),s("span",{staticClass:"line-number"},[e._v("25")]),s("br"),s("span",{staticClass:"line-number"},[e._v("26")]),s("br"),s("span",{staticClass:"line-number"},[e._v("27")]),s("br"),s("span",{staticClass:"line-number"},[e._v("28")]),s("br"),s("span",{staticClass:"line-number"},[e._v("29")]),s("br"),s("span",{staticClass:"line-number"},[e._v("30")]),s("br"),s("span",{staticClass:"line-number"},[e._v("31")]),s("br"),s("span",{staticClass:"line-number"},[e._v("32")]),s("br"),s("span",{staticClass:"line-number"},[e._v("33")]),s("br")])]),s("h4",{attrs:{id:"_2-截取完整网页"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_2-截取完整网页"}},[e._v("#")]),e._v(" 2. 截取完整网页")]),e._v(" "),s("div",{staticClass:"language- line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[e._v("await page.screenshot({ 'path': 'baidu.png', 'fullPage': True # 截取完整页面，否则只会截取屏幕可见大小 })\n")])]),e._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[e._v("1")]),s("br")])]),s("h4",{attrs:{id:"_3-将网页保存为-mhtml-文件"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_3-将网页保存为-mhtml-文件"}},[e._v("#")]),e._v(" 3. 将网页保存为 mhtml 文件")]),e._v(" "),s("p",[e._v("mhtml 格式能将网页所有内容都存储到单个文件中")]),e._v(" "),s("div",{staticClass:"language- line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[e._v("cdp = await page.target.createCDPSession()\nresult: dict = await cdp.send('Page.captureSnapshot', {'format': 'mhtml'})\nwith open('page.mhtml', 'w') as w:\n\tw.write(result['data'].replace('\\r\\n', '\\n'))  # 解决 windows 多次换行问题\n")])]),e._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[e._v("1")]),s("br"),s("span",{staticClass:"line-number"},[e._v("2")]),s("br"),s("span",{staticClass:"line-number"},[e._v("3")]),s("br"),s("span",{staticClass:"line-number"},[e._v("4")]),s("br")])])])}),[],!1,null,null,null);t.default=n.exports}}]);